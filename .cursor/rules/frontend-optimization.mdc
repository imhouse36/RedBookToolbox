---
description: 
globs: 
alwaysApply: false
---
# å‰ç«¯å¼€å‘è§„åˆ™ - å°çº¢ä¹¦å·¥å…·ç®±é¡¹ç›®

## ğŸ¯ é¡¹ç›®ç‰¹å®šè§„åˆ™

### ä»£ç ç»„ç»‡åŸåˆ™
- å¿…é¡»å°†è¶…è¿‡500è¡Œçš„JavaScriptæ–‡ä»¶è¿›è¡Œæ¨¡å—åŒ–æ‹†åˆ†
- å¿…é¡»å°†è¶…è¿‡800è¡Œçš„CSSæ–‡ä»¶æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†
- ä½¿ç”¨ES6æ¨¡å—åŒ–è¯­æ³•ï¼Œé¿å…å…¨å±€å˜é‡æ±¡æŸ“
- æ‰€æœ‰æ–°å¢åŠŸèƒ½å¿…é¡»ä»¥ç»„ä»¶åŒ–æ–¹å¼å®ç°

### æ–‡ä»¶å‘½åå’Œç»“æ„
```
environment/js/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ api.js           # APIè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ utils.js         # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ constants.js     # å¸¸é‡å®šä¹‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ toolManager.js   # å·¥å…·ç®¡ç†ç»„ä»¶
â”‚   â”œâ”€â”€ outputPanel.js   # è¾“å‡ºé¢æ¿ç»„ä»¶
â”‚   â”œâ”€â”€ progressBar.js   # è¿›åº¦æ¡ç»„ä»¶
â”‚   â””â”€â”€ statusIndicator.js # çŠ¶æ€æŒ‡ç¤ºå™¨
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ scriptRunner.js  # è„šæœ¬æ‰§è¡ŒæœåŠ¡
â”‚   â”œâ”€â”€ taskMonitor.js   # ä»»åŠ¡ç›‘æ§æœåŠ¡
â”‚   â””â”€â”€ configManager.js # é…ç½®ç®¡ç†æœåŠ¡
â””â”€â”€ main.js             # ä¸»å…¥å£æ–‡ä»¶

environment/css/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ variables.css    # CSSå˜é‡
â”‚   â”œâ”€â”€ reset.css        # é‡ç½®æ ·å¼
â”‚   â””â”€â”€ typography.css   # å­—ä½“æ ·å¼
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ header.css       # å¤´éƒ¨æ ·å¼
â”‚   â”œâ”€â”€ tools.css        # å·¥å…·åŒºåŸŸæ ·å¼
â”‚   â”œâ”€â”€ output.css       # è¾“å‡ºé¢æ¿æ ·å¼
â”‚   â””â”€â”€ progress.css     # è¿›åº¦æ¡æ ·å¼
â””â”€â”€ main.css            # ä¸»æ ·å¼æ–‡ä»¶
```

## ğŸ”§ JavaScript ç¼–ç è§„èŒƒ

### æ¨¡å—åŒ–è¦æ±‚
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ES6æ¨¡å—è¯­æ³•
// api.js
export class ApiService {
    constructor(baseURL = '/api') {
        this.baseURL = baseURL;
        this.abortController = null;
    }
    
    async executeScript(scriptName, params) {
        // å®ç°APIè°ƒç”¨
    }
}

// main.js  
import { ApiService } from './core/api.js';
import { ToolManager } from './components/toolManager.js';

// âŒ é”™è¯¯ï¼šé¿å…å…¨å±€å˜é‡
window.currentProcess = null; // ä¸è¦è¿™æ ·åš
```

### å¼‚æ­¥å¤„ç†è§„èŒƒ
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨async/await
async function executeScript(scriptName, params) {
    try {
        this.updateStatus('running');
        const result = await this.apiService.executeScript(scriptName, params);
        this.handleSuccess(result);
    } catch (error) {
        this.handleError(error);
    } finally {
        this.cleanup();
    }
}

// âŒ é”™è¯¯ï¼šé¿å…å›è°ƒåœ°ç‹±
fetch('/api/run-script').then(response => {
    return response.json();
}).then(data => {
    // å¤„ç†æ•°æ®
}).catch(error => {
    // å¤„ç†é”™è¯¯
});
```

### é”™è¯¯å¤„ç†æ ‡å‡†
```javascript
// âœ… å¿…é¡»çš„é”™è¯¯å¤„ç†æ¨¡å¼
class ScriptRunner {
    async runScript(scriptName, params) {
        try {
            // é¢„æ£€æŸ¥
            if (!this.validateParams(params)) {
                throw new ValidationError('å‚æ•°éªŒè¯å¤±è´¥');
            }
            
            // æ‰§è¡Œè„šæœ¬
            const result = await this.executeScript(scriptName, params);
            
            // æˆåŠŸå¤„ç†
            this.reportSuccess(result);
            return result;
            
        } catch (error) {
            // åˆ†ç±»é”™è¯¯å¤„ç†
            if (error instanceof ValidationError) {
                this.showUserError(error.message);
            } else if (error instanceof NetworkError) {
                this.showNetworkError();
            } else {
                this.showGenericError(error);
            }
            
            // é”™è¯¯æ—¥å¿—
            console.error('Script execution failed:', {
                scriptName,
                params,
                error: error.message,
                stack: error.stack
            });
            
            throw error; // é‡æ–°æŠ›å‡ºä¾›ä¸Šå±‚å¤„ç†
        }
    }
}
```

### æ€§èƒ½ä¼˜åŒ–è¦æ±‚
```javascript
// âœ… é˜²æŠ–å’ŒèŠ‚æµ
class OutputPanel {
    constructor() {
        this.updateOutput = this.debounce(this._updateOutput.bind(this), 100);
        this.scrollToBottom = this.throttle(this._scrollToBottom.bind(this), 50);
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// âœ… å†…å­˜æ³„æ¼é˜²æŠ¤
class ComponentBase {
    constructor() {
        this.eventListeners = [];
        this.timers = [];
    }
    
    addEventListener(element, event, handler) {
        element.addEventListener(event, handler);
        this.eventListeners.push(() => element.removeEventListener(event, handler));
    }
    
    destroy() {
        // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
        this.eventListeners.forEach(cleanup => cleanup());
        this.eventListeners = [];
        
        // æ¸…ç†å®šæ—¶å™¨
        this.timers.forEach(timer => clearTimeout(timer));
        this.timers = [];
    }
}
```

## ğŸ¨ CSS ç¼–ç è§„èŒƒ

### CSSå˜é‡ä½¿ç”¨
```css
/* âœ… å¿…é¡»ï¼šåœ¨variables.cssä¸­å®šä¹‰æ‰€æœ‰é¢œè‰²å’Œå°ºå¯¸ */
:root {
    /* é¢œè‰²ç³»ç»Ÿ */
    --primary-color: #3b82f6;
    --secondary-color: #8b5cf6;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    
    /* é—´è·ç³»ç»Ÿ */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    
    /* å­—ä½“ç³»ç»Ÿ */
    --font-size-sm: 0.875rem;
    --font-size-base: 1rem;
    --font-size-lg: 1.125rem;
    --font-size-xl: 1.25rem;
}

/* âœ… ä½¿ç”¨å˜é‡è€Œéç¡¬ç¼–ç å€¼ */
.tool-item {
    background: var(--primary-color);
    padding: var(--spacing-md);
    font-size: var(--font-size-base);
}
```

### BEMå‘½åè§„èŒƒ
```css
/* âœ… æ­£ç¡®ï¼šBEMå‘½å */
.tool-panel {}
.tool-panel__header {}
.tool-panel__body {}
.tool-panel__footer {}

.tool-item {}
.tool-item--active {}
.tool-item--disabled {}
.tool-item__icon {}
.tool-item__title {}
.tool-item__description {}

/* âŒ é”™è¯¯ï¼šé¿å…æ·±å±‚åµŒå¥— */
.tool-panel .header .title .text span {} /* ä¸è¦è¿™æ ·åš */
```

### å“åº”å¼è®¾è®¡è¦æ±‚
```css
/* âœ… å¿…é¡»ï¼šä½¿ç”¨ç§»åŠ¨ä¼˜å…ˆè®¾è®¡ */
.tool-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
}

@media (min-width: 768px) {
    .tool-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) {
    .tool-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}
```

## ğŸ“Š ç»„ä»¶å¼€å‘è§„èŒƒ

### ç»„ä»¶åŸºç±»æ¨¡å¼
```javascript
// âœ… æ‰€æœ‰ç»„ä»¶å¿…é¡»ç»§æ‰¿ComponentBase
class ComponentBase {
    constructor(container, options = {}) {
        this.container = container;
        this.options = { ...this.defaultOptions, ...options };
        this.eventListeners = [];
        this.isDestroyed = false;
        
        this.init();
    }
    
    get defaultOptions() {
        return {};
    }
    
    init() {
        this.render();
        this.bindEvents();
    }
    
    render() {
        // å­ç±»å®ç°
        throw new Error('render method must be implemented');
    }
    
    bindEvents() {
        // å­ç±»å®ç°
    }
    
    destroy() {
        if (this.isDestroyed) return;
        
        this.eventListeners.forEach(cleanup => cleanup());
        this.eventListeners = [];
        this.isDestroyed = true;
    }
}

// âœ… ç»„ä»¶å®ç°ç¤ºä¾‹
class ProgressBar extends ComponentBase {
    get defaultOptions() {
        return {
            showPercentage: true,
            showETA: true,
            animated: true
        };
    }
    
    render() {
        this.container.innerHTML = `
            <div class="progress-bar">
                <div class="progress-bar__fill"></div>
                <div class="progress-bar__text"></div>
            </div>
        `;
        
        this.fillElement = this.container.querySelector('.progress-bar__fill');
        this.textElement = this.container.querySelector('.progress-bar__text');
    }
    
    updateProgress(percent, message = '') {
        if (this.isDestroyed) return;
        
        this.fillElement.style.width = `${percent}%`;
        this.textElement.textContent = message;
        
        // è§¦å‘æ›´æ–°äº‹ä»¶
        this.container.dispatchEvent(new CustomEvent('progress-updated', {
            detail: { percent, message }
        }));
    }
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è¦æ±‚

### ä»£ç åˆ†å‰²
```javascript
// âœ… åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶
async function loadAdvancedEditor() {
    const { AdvancedEditor } = await import('./components/advancedEditor.js');
    return new AdvancedEditor();
}

// âœ… å»¶è¿ŸåŠ è½½éå…³é”®åŠŸèƒ½
class ToolManager {
    async showAdvancedOptions() {
        if (!this.advancedPanel) {
            const { AdvancedPanel } = await import('./components/advancedPanel.js');
            this.advancedPanel = new AdvancedPanel();
        }
        this.advancedPanel.show();
    }
}
```

### DOMæ“ä½œä¼˜åŒ–
```javascript
// âœ… æ‰¹é‡DOMæ“ä½œ
class OutputPanel {
    appendMultipleLines(lines) {
        const fragment = document.createDocumentFragment();
        
        lines.forEach(line => {
            const lineElement = document.createElement('div');
            lineElement.className = 'output-line';
            lineElement.textContent = line;
            fragment.appendChild(lineElement);
        });
        
        this.container.appendChild(fragment);
        this.scrollToBottom();
    }
    
    // âœ… ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡å†…å®¹
    setupVirtualScrolling() {
        if (this.outputLines.length > 1000) {
            this.enableVirtualScrolling();
        }
    }
}
```

## ğŸ“ æ–‡æ¡£å’Œæ³¨é‡Šè¦æ±‚

### JSDocæ³¨é‡Šæ ‡å‡†
```javascript
/**
 * æ‰§è¡Œå·¥å…·è„šæœ¬
 * @param {string} scriptName - è„šæœ¬åç§° (webp_video, md5_renew, ç­‰)
 * @param {Object} params - è„šæœ¬å‚æ•°
 * @param {string} params.path - ç›®æ ‡è·¯å¾„
 * @param {number} [params.duration=3] - è½¬æ¢æ—¶é•¿(ç§’)
 * @param {string} [params.overwrite='ask'] - è¦†ç›–æ¨¡å¼ (skip|replace_all|ask)
 * @returns {Promise<Object>} æ‰§è¡Œç»“æœ
 * @throws {ValidationError} å‚æ•°éªŒè¯å¤±è´¥
 * @throws {NetworkError} ç½‘ç»œè¿æ¥å¤±è´¥
 * @example
 * const result = await scriptRunner.execute('webp_video', {
 *   path: '/path/to/videos',
 *   duration: 5,
 *   overwrite: 'skip'
 * });
 */
async execute(scriptName, params) {
    // å®ç°...
}
```

## ğŸ§ª æµ‹è¯•è¦æ±‚

### åŸºç¡€æµ‹è¯•ç”¨ä¾‹
```javascript
// âœ… æ¯ä¸ªç»„ä»¶å¿…é¡»åŒ…å«åŸºç¡€æµ‹è¯•
// tests/components/progressBar.test.js
describe('ProgressBar', () => {
    let container, progressBar;
    
    beforeEach(() => {
        container = document.createElement('div');
        document.body.appendChild(container);
        progressBar = new ProgressBar(container);
    });
    
    afterEach(() => {
        progressBar.destroy();
        document.body.removeChild(container);
    });
    
    test('åº”è¯¥æ­£ç¡®åˆå§‹åŒ–', () => {
        expect(container.querySelector('.progress-bar')).toBeTruthy();
    });
    
    test('åº”è¯¥æ­£ç¡®æ›´æ–°è¿›åº¦', () => {
        progressBar.updateProgress(50, '50% å®Œæˆ');
        const fill = container.querySelector('.progress-bar__fill');
        expect(fill.style.width).toBe('50%');
    });
});
```

## ğŸ¯ ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹

### æäº¤å‰å¿…æ£€é¡¹
- [ ] æ˜¯å¦æ¶ˆé™¤äº†å…¨å±€å˜é‡
- [ ] æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº†ES6æ¨¡å—
- [ ] æ˜¯å¦æ·»åŠ äº†é”™è¯¯å¤„ç†
- [ ] æ˜¯å¦æ·»åŠ äº†JSDocæ³¨é‡Š
- [ ] æ˜¯å¦ä½¿ç”¨äº†CSSå˜é‡
- [ ] æ˜¯å¦éµå¾ªBEMå‘½å
- [ ] æ˜¯å¦æ·»åŠ äº†ç»„ä»¶é”€æ¯é€»è¾‘
- [ ] æ˜¯å¦ä¼˜åŒ–äº†DOMæ“ä½œæ€§èƒ½
- [ ] æ˜¯å¦å…¼å®¹ç›®æ ‡æµè§ˆå™¨
- [ ] æ˜¯å¦æ·»åŠ äº†åŸºç¡€æµ‹è¯•ç”¨ä¾‹

