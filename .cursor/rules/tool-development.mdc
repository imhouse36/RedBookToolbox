---
description:
globs:
alwaysApply: false
---
# 工具开发指南

## 工具架构模式
每个工具都遵循统一的开发模式，确保一致的用户体验和代码可维护性。

## 现有工具列表
基于 [index.html](mdc:index.html) 中的工具定义：

1. **自动创建并复制** (`auto_build_copy`) - 创建文件夹并随机复制图片
2. **MD5值修改** (`md5_renew`) - 通过添加随机字节改变MD5值  
3. **批量解压缩** (`unzip`) - 自动解压所有ZIP压缩文件
4. **视频转WebP动图** (`webp_video`) - 批量将视频文件转换为WebP格式
5. **WebP重新生成** (`webp_resize`) - 重新生成超过阈值的WebP文件
6. **批量重命名文件** (`rename_files`) - 重命名为"文件夹名_编号.扩展名"格式
7. **Excel批量处理** (`excel_renew`) - 批量清空Excel文件的K2单元格和C列内容
8. **批量创建文件夹** (`build_folder`) - 在指定目录下创建编号文件夹
9. **智能文件复制** (`copy_files`) - 随机分配图片到各个子目录
10. **终止按钮测试** (`test_stop_button`) - 测试Web界面终止按钮功能

## 添加新工具步骤

### 1. HTML结构
在 [index.html](mdc:index.html) 的 `.tools-list` 中添加新的 `.tool-item`：

```html
<div class="tool-item" data-tool="new_tool_name">
    <div class="tool-header">
        <div class="tool-number">编号</div>
        <div class="tool-icon category">
            <i class="fas fa-icon-name"></i>
        </div>
        <div class="tool-info">
            <h3>工具名称</h3>
            <p>工具描述</p>
        </div>
        <div class="expand-indicator">
            <i class="fas fa-chevron-down"></i>
        </div>
    </div>
    <div class="tool-form">
        <!-- 输入字段 -->
        <div class="input-group">
            <label>字段标签</label>
            <input type="text" id="tool-field" name="field_name" placeholder="提示文本">
        </div>
        <!-- 执行按钮 -->
        <div class="button-group">
            <button class="execute-btn" data-script="new_tool_name">
                <i class="fas fa-play"></i>
                开始执行
            </button>
            <button class="stop-btn-inline" data-script="new_tool_name" style="display: none;">
                <i class="fas fa-stop"></i>
                终止执行
            </button>
        </div>
    </div>
</div>
```

### 2. 工具图标类别
在 [environment/styles.css](mdc:environment/styles.css) 中选择合适的图标类别：
- `.tool-icon.folder` - 文件夹操作 (橙色渐变)
- `.tool-icon.file` - 文件操作 (蓝色渐变)  
- `.tool-icon.media` - 媒体处理 (绿色渐变)
- `.tool-icon.archive` - 压缩/解压 (紫色渐变)
- `.tool-icon.security` - 安全/加密 (红色渐变)
- `.tool-icon.automation` - 自动化 (青色渐变)
- `.tool-icon.testing` - 测试工具 (橙色渐变)

### 3. 输入字段模式

#### 路径选择字段（推荐）
```html
<div class="input-group">
    <label>目录路径</label>
    <div class="input-group-with-browse">
        <input type="text" id="tool-path" name="path" placeholder="请输入路径">
        <button type="button" class="browse-btn" data-target="tool-path" title="选择文件夹">
            <i class="fas fa-ellipsis-h"></i>
        </button>
    </div>
</div>
```

#### 普通输入字段
```html
<div class="input-group">
    <label>字段名称</label>
    <input type="text" id="tool-field" name="field" placeholder="提示文本">
</div>
```

#### 选择框
```html
<div class="input-group">
    <label>选项</label>
    <select id="tool-select" name="option">
        <option value="false">否</option>
        <option value="true">是</option>
    </select>
</div>
```

### 4. 按钮组规范
每个工具必须包含：
- **执行按钮**: `data-script` 属性对应后端脚本名
- **终止按钮**: 初始隐藏，执行时显示
- **统一样式**: 使用 `.execute-btn` 和 `.stop-btn-inline` 类

## 后端接口规范

### 请求格式
- **方法**: POST
- **端点**: `/execute`
- **数据**: JSON格式，包含工具名称和参数

### 响应格式
- **实时输出**: 通过WebSocket或长连接推送
- **状态更新**: 包含进度、成功/失败状态
- **错误处理**: 统一的错误格式和提示

## 用户体验要求

### 交互反馈
1. **点击展开**: 工具表单平滑展开/收起动画
2. **执行状态**: 按钮状态切换，禁用重复执行
3. **进度显示**: 实时输出执行过程和结果
4. **错误提示**: 清晰的错误信息和解决建议

### 输入验证
1. **路径验证**: 检查路径是否存在和可访问
2. **参数验证**: 数值范围、格式检查
3. **依赖检查**: 确保必要的工具和环境可用

### 性能优化
1. **并发控制**: 限制同时执行的任务数量
2. **内存管理**: 大文件处理时的内存优化
3. **进度反馈**: 长时间任务的进度条显示
